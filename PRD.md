# CV Monitor Dashboard PRD
## Product Requirements Document

> **Version**: 1.0
> **Last Updated**: 2024.12
> **Status**: 현재 구현 기준

---

## 1. 제품 개요

### 1.1 제품 정의

**CV Monitor Dashboard**는 이커머스 플랫폼의 소비자 리뷰를 수집, 분석, 시각화하는 통합 모니터링 솔루션입니다.

```
┌─────────────────────────────────────────────────────────────────┐
│                    CV Monitor Dashboard                          │
│                                                                   │
│   ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐      │
│   │ 리뷰 수집 │ → │ AI 분석  │ → │ 데이터   │ → │ 인사이트 │      │
│   │ Crawling │    │ Tagging │    │ 시각화   │    │ 도출    │      │
│   └─────────┘    └─────────┘    └─────────┘    └─────────┘      │
└─────────────────────────────────────────────────────────────────┘
```

### 1.2 핵심 가치

| 가치 | 설명 |
|------|------|
| **실시간 모니터링** | 여러 이커머스 채널의 리뷰를 한 곳에서 관리 |
| **AI 기반 분석** | GPT-4를 활용한 감정 분석 및 키워드 추출 |
| **액션 가능한 인사이트** | 데이터 기반 개선점 및 리스크 자동 도출 |
| **비교 분석** | 상품/카테고리 간 성과 비교 |

### 1.3 기술 스택

```yaml
Frontend:
  - Framework: Next.js 14 (App Router)
  - UI: React 19 + Radix UI + Tailwind CSS
  - Charts: Recharts
  - State: React Hooks

Backend:
  - Runtime: Next.js API Routes (Edge Compatible)
  - Database: Supabase (PostgreSQL) / 로컬 JSON DB
  - AI: OpenAI GPT-4o / GPT-4o-mini
  - External: Crawler API (Node.js)

Infrastructure:
  - Cache: In-memory (Rate Limiter, Result Cache)
  - Auth: Cookie-based Session
```

---

## 2. 서비스 아키텍처

### 2.1 시스템 구성도

```
┌──────────────────────────────────────────────────────────────────────────┐
│                              CLIENT (Browser)                             │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐            │
│  │Dashboard│ │  Items  │ │ Reviews │ │Categories│ │  Login  │            │
│  └────┬────┘ └────┬────┘ └────┬────┘ └────┬────┘ └────┬────┘            │
└───────┼──────────┼──────────┼──────────┼──────────┼──────────────────────┘
        │          │          │          │          │
        └──────────┴──────────┴──────────┴──────────┘
                              │
                    ┌─────────▼─────────┐
                    │   lib/api.ts      │  ← Timeout 30초
                    │  (API Client)     │
                    └─────────┬─────────┘
                              │
┌─────────────────────────────▼─────────────────────────────────────────────┐
│                         NEXT.JS API ROUTES                                 │
│  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐              │
│  │/api/items  │ │/api/reviews│ │/api/analyze│ │/api/auth   │              │
│  └─────┬──────┘ └─────┬──────┘ └─────┬──────┘ └─────┬──────┘              │
│        │              │              │              │                      │
│  ┌─────▼──────────────▼──────────────▼──────────────▼─────┐               │
│  │                    MIDDLEWARE LAYER                     │               │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐    │               │
│  │  │ Rate Limiter │ │    Cache     │ │ Error Handler│    │               │
│  │  │  - OpenAI    │ │  - Crawl 30m │ │  - Timeout   │    │               │
│  │  │  - Crawler   │ │  - Meta 60m  │ │  - Fallback  │    │               │
│  │  └──────────────┘ └──────────────┘ └──────────────┘    │               │
│  └─────────────────────────────────────────────────────────┘               │
└───────────────────────────────┬───────────────────────────────────────────┘
                                │
        ┌───────────────────────┼───────────────────────┐
        │                       │                       │
┌───────▼───────┐       ┌───────▼───────┐       ┌───────▼───────┐
│   DATABASE    │       │   CRAWLER     │       │   OPENAI      │
│  ┌─────────┐  │       │     API       │       │     API       │
│  │Supabase │  │       │  ┌─────────┐  │       │  ┌─────────┐  │
│  │PostgreSQL│ │       │  │/crawl   │  │       │  │GPT-4o   │  │
│  └─────────┘  │       │  │/extract │  │       │  │GPT-4o-  │  │
│       or      │       │  └─────────┘  │       │  │  mini   │  │
│  ┌─────────┐  │       │  Timeout:     │       │  └─────────┘  │
│  │Local DB │  │       │  120초        │       │  Timeout: 60초│
│  │(.json)  │  │       │               │       │  Retry: 2회   │
│  └─────────┘  │       │               │       │               │
└───────────────┘       └───────────────┘       └───────────────┘
```

### 2.2 데이터 모델

```
┌─────────────────┐       ┌─────────────────┐
│   categories    │       │     items       │
├─────────────────┤       ├─────────────────┤
│ id (PK)         │──┐    │ id (PK)         │
│ name            │  │    │ category_id (FK)│◄─┘
│ color           │  │    │ url (UNIQUE)    │
│ created_at      │  │    │ platform        │
└─────────────────┘  │    │ product_name    │
                     │    │ product_image   │
                     │    │ price           │
                     │    │ last_crawled_at │
                     │    │ created_at      │
                     │    └────────┬────────┘
                     │             │
                     │             │ 1:N
                     │             ▼
                     │    ┌─────────────────┐
                     │    │    reviews      │
                     │    ├─────────────────┤
                     │    │ id (PK)         │
                     │    │ item_id (FK)    │
                     │    │ author          │
                     │    │ rating (1-5)    │
                     │    │ content         │
                     │    │ images[]        │
                     │    │ date            │
                     │    │ sentiment       │◄── AI 분석 결과
                     │    │ keywords[]      │◄── AI 추출
                     │    │ crawled_at      │
                     │    └─────────────────┘
                     │
                     │    ┌─────────────────┐
                     │    │ review_analysis │
                     │    ├─────────────────┤
                     └───►│ id (PK)         │
                          │ item_id (FK)    │
                          │ analysis_type   │
                          │ result (JSON)   │
                          │ created_at      │
                          └─────────────────┘
```

---

## 3. 핵심 서비스 로직 플로우

### 3.1 상품 등록 플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        상품 등록 Flow                                    │
└─────────────────────────────────────────────────────────────────────────┘

User                    Frontend                 API                  Crawler
 │                         │                      │                      │
 │  1. URL 입력             │                      │                      │
 │ ───────────────────────>│                      │                      │
 │                         │                      │                      │
 │                         │  2. POST /api/items/extract                 │
 │                         │ ─────────────────────>│                      │
 │                         │                      │                      │
 │                         │                      │  3. 캐시 확인          │
 │                         │                      │ ──────┐               │
 │                         │                      │ <─────┘               │
 │                         │                      │                      │
 │                         │                      │  4. POST /extract/metadata
 │                         │                      │ ─────────────────────>│
 │                         │                      │                      │
 │                         │                      │                      │ 5. 웹 크롤링
 │                         │                      │                      │ ────┐
 │                         │                      │                      │ <───┘
 │                         │                      │                      │
 │                         │                      │  6. 메타데이터 반환    │
 │                         │                      │ <─────────────────────│
 │                         │                      │                      │
 │                         │                      │  7. 캐시 저장 (1시간)  │
 │                         │                      │ ──────┐               │
 │                         │                      │ <─────┘               │
 │                         │                      │                      │
 │  8. 메타데이터 표시       │                      │                      │
 │ <───────────────────────│                      │                      │
 │                         │                      │                      │
 │  9. 등록 확인            │                      │                      │
 │ ───────────────────────>│                      │                      │
 │                         │                      │                      │
 │                         │  10. POST /api/items │                      │
 │                         │ ─────────────────────>│                      │
 │                         │                      │                      │
 │                         │                      │  11. DB 저장          │
 │                         │                      │ ──────────────────────►DB
 │                         │                      │                      │
 │  12. 등록 완료           │                      │                      │
 │ <───────────────────────│                      │                      │
```

**관련 코드 위치:**
- 프론트엔드: `app/items/page.tsx` → `extractMetadata()`, `createItem()`
- API: `app/api/items/extract/route.ts`, `app/api/items/route.ts`
- 캐시: `lib/utils/cache.ts` → `metadataCache`

---

### 3.2 리뷰 크롤링 플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        리뷰 크롤링 Flow                                  │
└─────────────────────────────────────────────────────────────────────────┘

User                    Frontend                 API                  Crawler
 │                         │                      │                      │
 │  1. 크롤링 버튼 클릭      │                      │                      │
 │ ───────────────────────>│                      │                      │
 │                         │                      │                      │
 │                         │  2. POST /api/items/{id}/crawl              │
 │                         │ ─────────────────────>│                      │
 │                         │                      │                      │
 │                         │                      │  3. 캐시 확인 (30분)  │
 │                         │                      │ ──────┐               │
 │                         │                      │ <─────┘               │
 │                         │                      │                      │
 │                         │                      │  [캐시 HIT]           │
 │                         │                      │  → 즉시 반환          │
 │                         │                      │                      │
 │                         │                      │  [캐시 MISS]          │
 │                         │                      │                      │
 │                         │                      │  4. Rate Limit 확인   │
 │                         │                      │ ──────┐ (분당 10회)   │
 │                         │                      │ <─────┘               │
 │                         │                      │                      │
 │                         │                      │  5. POST /crawl/reviews
 │                         │                      │ ─────────────────────>│
 │                         │                      │   (Timeout: 120초)    │
 │                         │                      │                      │
 │                         │                      │                      │ 6. 리뷰 크롤링
 │                         │                      │                      │ ────┐
 │                         │                      │                      │ <───┘
 │                         │                      │                      │
 │                         │                      │  7. 리뷰 배열 반환    │
 │                         │                      │ <─────────────────────│
 │                         │                      │                      │
 │                         │                      │  8. Bulk Upsert       │
 │                         │                      │ ──────────────────────►DB
 │                         │                      │   (중복 체크:          │
 │                         │                      │    item_id+author+    │
 │                         │                      │    date+content)      │
 │                         │                      │                      │
 │                         │                      │  9. last_crawled_at   │
 │                         │                      │     업데이트           │
 │                         │                      │ ──────────────────────►DB
 │                         │                      │                      │
 │                         │                      │  10. 캐시 저장         │
 │                         │                      │ ──────┐               │
 │                         │                      │ <─────┘               │
 │                         │                      │                      │
 │  11. 결과 표시           │  {crawled, inserted, skipped}               │
 │ <───────────────────────│ <────────────────────│                      │
```

**관련 코드 위치:**
- 프론트엔드: `app/items/page.tsx` → `triggerCrawl()`
- API: `app/api/items/[id]/crawl/route.ts`
- Rate Limiter: `lib/utils/rate-limiter.ts` → `crawlerRateLimiter`
- 캐시: `lib/utils/cache.ts` → `crawlCache`
- DB 저장: `lib/local-db.ts` → `localReviews.bulkUpsert()`

---

### 3.3 AI 감정 분석 플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        AI 감정 분석 Flow                                 │
└─────────────────────────────────────────────────────────────────────────┘

User                    Frontend                 API                  OpenAI
 │                         │                      │                      │
 │  1. 분석 버튼 클릭       │                      │                      │
 │ ───────────────────────>│                      │                      │
 │                         │                      │                      │
 │                         │  2. POST /api/analyze                       │
 │                         │     {itemIds, type:"tag"}                   │
 │                         │ ─────────────────────>│                      │
 │                         │                      │                      │
 │                         │                      │  3. 미분석 리뷰 조회   │
 │                         │                      │ ────┐ (sentiment=null)│
 │                         │                      │ <───┘                 │
 │                         │                      │                      │
 │                         │                      │  [리뷰 없음]           │
 │                         │                      │  → 즉시 반환          │
 │                         │                      │                      │
 │                         │                      │  [리뷰 있음]           │
 │                         │                      │                      │
 │                         │                      │  4. 배치 처리 (5개씩) │
 │                         │                      │ ──────────────────────┐
 │                         │                      │                      │
 │                         │                      │   ┌──────────────────▼──┐
 │                         │                      │   │ for each batch:     │
 │                         │                      │   │                     │
 │                         │                      │   │  5. Rate Limit 대기 │
 │                         │                      │   │  ────┐              │
 │                         │                      │   │  <───┘              │
 │                         │                      │   │                     │
 │                         │                      │   │  6. GPT-4o-mini     │
 │                         │                      │   │  ─────────────────>│
 │                         │                      │   │                    │
 │                         │                      │   │  Prompt:           │
 │                         │                      │   │  "너는 한국어       │
 │                         │                      │   │   이커머스 리뷰를   │
 │                         │                      │   │   구조화 태깅하는   │
 │                         │                      │   │   분석기다."        │
 │                         │                      │   │                    │
 │                         │                      │   │  7. JSON 응답       │
 │                         │                      │   │  <─────────────────│
 │                         │                      │   │  {                 │
 │                         │                      │   │   sentiment,       │
 │                         │                      │   │   keywords[],      │
 │                         │                      │   │   aspects[],       │
 │                         │                      │   │   issues[],        │
 │                         │                      │   │   summary_1line    │
 │                         │                      │   │  }                 │
 │                         │                      │   │                     │
 │                         │                      │   └──────────────────┬──┘
 │                         │                      │ <─────────────────────┘
 │                         │                      │                      │
 │                         │                      │  8. DB 업데이트       │
 │                         │                      │ ────────────────────>DB
 │                         │                      │  (sentiment, keywords)│
 │                         │                      │                      │
 │  9. 분석 완료 표시       │  {analyzed: n}       │                      │
 │ <───────────────────────│ <────────────────────│                      │
```

**AI 분석 결과 스키마:**
```typescript
{
  reviewId: string
  sentiment: "positive" | "negative" | "neutral"
  keywords: string[]           // 최대 12개
  aspects: (
    | "배송" | "포장" | "품질" | "가격"
    | "맛/향" | "효과/체감" | "사용성"
    | "고객응대" | "기타"
  )[]
  issues: (
    | "파손" | "누락" | "지연" | "불량"
    | "오배송" | "환불/교환" | "과장광고의심" | "없음"
  )[]
  summary_1line: string
}
```

**관련 코드 위치:**
- API: `app/api/analyze/route.ts`
- OpenAI 서비스: `lib/services/openai.ts` → `tagReview()`, `tagReviewsBatch()`
- Rate Limiter: `lib/utils/rate-limiter.ts` → `openaiRateLimiter`

---

### 3.4 인사이트 생성 플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        인사이트 생성 Flow                                │
└─────────────────────────────────────────────────────────────────────────┘

User                    Frontend                 API                  OpenAI
 │                         │                      │                      │
 │  1. AI 분석 버튼 클릭    │                      │                      │
 │ ───────────────────────>│                      │                      │
 │                         │                      │                      │
 │                         │  2. POST /api/analyze                       │
 │                         │     {itemIds, type:"insights", dateRange}   │
 │                         │ ─────────────────────>│                      │
 │                         │                      │                      │
 │                         │                      │  3. 리뷰 통계 계산    │
 │                         │                      │ ────┐                │
 │                         │                      │ <───┘                │
 │                         │                      │  - totalReviews      │
 │                         │                      │  - avgRating         │
 │                         │                      │  - positiveRate      │
 │                         │                      │  - negativeRate      │
 │                         │                      │  - topKeywords       │
 │                         │                      │                      │
 │                         │                      │  4. 샘플 리뷰 추출    │
 │                         │                      │ ────┐ (긍정/부정 각 5)│
 │                         │                      │ <───┘                │
 │                         │                      │                      │
 │                         │                      │  5. Rate Limit 대기   │
 │                         │                      │ ──────┐               │
 │                         │                      │ <─────┘               │
 │                         │                      │                      │
 │                         │                      │  6. GPT-4o 호출       │
 │                         │                      │ ─────────────────────>│
 │                         │                      │                      │
 │                         │                      │  Prompt:              │
 │                         │                      │  "너는 소비자 보이스  │
 │                         │                      │   대시보드 분석가다.  │
 │                         │                      │   입력된 통계/샘플    │
 │                         │                      │   범위 내에서만       │
 │                         │                      │   결론을 내리고,      │
 │                         │                      │   숫자는 절대         │
 │                         │                      │   창작하지 마라."     │
 │                         │                      │                      │
 │                         │                      │  7. 구조화된 인사이트 │
 │                         │                      │ <─────────────────────│
 │                         │                      │                      │
 │                         │                      │  8. 분석 결과 캐시    │
 │                         │                      │ ────────────────────>DB
 │                         │                      │                      │
 │  9. 인사이트 표시        │                      │                      │
 │ <───────────────────────│                      │                      │
```

**인사이트 결과 스키마:**
```typescript
{
  overview: string              // 전체 요약 (2-3문장)
  pros: string[]                // 긍정 포인트 (최대 5개)
  cons: string[]                // 부정 포인트 (최대 5개)
  actions: {
    title: string
    detail: string
    owner_hint: "상품/MD" | "CS" | "물류" | "마케팅" | "기타"
    priority: "P0" | "P1" | "P2"
  }[]                           // 액션 아이템 (최대 6개)
  risks: string[]               // 리스크 (최대 4개)
  evidence: {
    reviewId: string
    why_relevant: string
  }[]                           // 근거 리뷰 (최대 6개)
}
```

**관련 코드 위치:**
- API: `app/api/analyze/route.ts`
- OpenAI 서비스: `lib/services/openai.ts` → `generateInsights()`

---

### 3.5 워드클라우드 데이터 플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        워드클라우드 Flow                                 │
└─────────────────────────────────────────────────────────────────────────┘

                    ┌─────────────────────────────────────────┐
                    │          리뷰 수집 단계                   │
                    └─────────────────────────────────────────┘
                                      │
                                      ▼
                    ┌─────────────────────────────────────────┐
                    │         AI 분석 단계                     │
                    │   GPT가 각 리뷰별 keywords[] 추출        │
                    │   예: ["배송빠름", "포장꼼꼼", "맛있어요"]  │
                    └─────────────────────────────────────────┘
                                      │
                                      ▼
                    ┌─────────────────────────────────────────┐
                    │         DB 저장                          │
                    │   reviews.keywords = ["키워드1", ...]    │
                    │   reviews.sentiment = "positive"         │
                    └─────────────────────────────────────────┘
                                      │
                                      ▼
                    ┌─────────────────────────────────────────┐
                    │         키워드 통계 집계                  │
                    │   GET /api/analyze?type=keywords         │
                    │                                          │
                    │   감정별 키워드 빈도 계산:                 │
                    │   positive: {배송빠름: 15, 맛있어요: 12}   │
                    │   negative: {배송지연: 8, 포장불량: 5}     │
                    └─────────────────────────────────────────┘
                                      │
                                      ▼
                    ┌─────────────────────────────────────────┐
                    │         프론트엔드 렌더링                 │
                    │                                          │
                    │   react-wordcloud 라이브러리 사용         │
                    │                                          │
                    │   ┌───────────────────────────────┐      │
                    │   │    긍정 키워드      부정 키워드   │      │
                    │   │  ┌─────────────┐ ┌─────────────┐│      │
                    │   │  │  배송빠름    │ │  배송지연    ││      │
                    │   │  │ 맛있어요    │ │ 포장불량    ││      │
                    │   │  │  포장꼼꼼   │ │  파손      ││      │
                    │   │  └─────────────┘ └─────────────┘│      │
                    │   └───────────────────────────────┘      │
                    └─────────────────────────────────────────┘
```

**관련 코드 위치:**
- 키워드 집계: `lib/local-db.ts` → `localReviews.getKeywordStats()`
- 프론트엔드: `app/reviews/page.tsx` → Keywords 탭

---

## 4. 페이지별 기능 명세

### 4.1 Dashboard (`/dashboard`)

```
┌─────────────────────────────────────────────────────────────────────────┐
│  ┌─ 사이드바 ─┐                                                         │
│  │ 📊 대시보드 │  ┌──────────────────────────────────────────────────┐  │
│  │ 📦 상품관리 │  │                   CV Monitor                      │  │
│  │ 💬 리뷰분석 │  ├──────────────────────────────────────────────────┤  │
│  │ 📁 카테고리 │  │                                                   │  │
│  │            │  │  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐      │  │
│  │            │  │  │등록상품 │ │수집리뷰 │ │평균평점 │ │긍정비율 │      │  │
│  │            │  │  │   12   │ │  1,234 │ │  4.2   │ │  78%  │      │  │
│  │            │  │  └────────┘ └────────┘ └────────┘ └────────┘      │  │
│  │            │  │                                                   │  │
│  │            │  │  ┌─────────────────────────────────────────────┐  │  │
│  │            │  │  │          7일 리뷰 트렌드 (Area Chart)         │  │  │
│  │            │  │  │                      ████                    │  │  │
│  │            │  │  │                 █████    ████                │  │  │
│  │            │  │  │            █████            ████             │  │  │
│  │            │  │  │       █████                     ████         │  │  │
│  │            │  │  └─────────────────────────────────────────────┘  │  │
│  │            │  │                                                   │  │
│  │            │  │  ┌─────────────────┐  ┌─────────────────┐        │  │
│  │            │  │  │ 카테고리별 통계   │  │  최근 크롤링 상품  │        │  │
│  │            │  │  │                 │  │  ┌────┐ ┌────┐  │        │  │
│  │            │  │  │ 건강식품  45%   │  │  │ 🖼️ │ │ 🖼️ │  │        │  │
│  │            │  │  │ 뷰티     30%   │  │  │상품A│ │상품B│  │        │  │
│  │            │  │  │ 식품     25%   │  │  └────┘ └────┘  │        │  │
│  │            │  │  └─────────────────┘  └─────────────────┘        │  │
│  │            │  │                                                   │  │
│  └────────────┘  └──────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
```

**데이터 로딩:**
```typescript
// 동시 API 호출
const [categories, items, reviews] = await Promise.all([
  getCategories(),
  getItems(),
  getReviews({ limit: 100 })
])
```

---

### 4.2 Items (`/items`)

```
┌─────────────────────────────────────────────────────────────────────────┐
│  상품 관리                                                [+ 상품 등록]   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  카테고리 필터: [전체 ▼] [건강식품] [뷰티] [+ 카테고리 추가]                │
│                                                                          │
│  ┌─────────────────────┐  ┌─────────────────────┐                        │
│  │ 🖼️ 상품 이미지        │  │ 🖼️ 상품 이미지        │                        │
│  │                     │  │                     │                        │
│  │ 상품명: 비타민C 1000 │  │ 상품명: 프로바이오틱스 │                        │
│  │ 플랫폼: 네이버 스마트스토어│  │ 플랫폼: 쿠팡           │                        │
│  │ 카테고리: 건강식품    │  │ 카테고리: 건강식품     │                        │
│  │ 평점: ⭐ 4.5 (234)   │  │ 평점: ⭐ 4.2 (156)    │                        │
│  │ 마지막 수집: 2시간 전  │  │ 마지막 수집: 1일 전    │                        │
│  │                     │  │                     │                        │
│  │ [수집] [수정] [삭제] │  │ [수집] [수정] [삭제]  │                        │
│  └─────────────────────┘  └─────────────────────┘                        │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

**주요 기능:**

| 기능 | API | 설명 |
|------|-----|------|
| 상품 등록 | `POST /api/items` | URL에서 메타데이터 추출 후 저장 |
| 상품 수정 | `PUT /api/items/{id}` | 상품명, 카테고리 변경 |
| 상품 삭제 | `DELETE /api/items/{id}` | 연관 리뷰도 함께 삭제 |
| 리뷰 수집 | `POST /api/items/{id}/crawl` | 크롤러 호출하여 리뷰 저장 |
| 카테고리 관리 | `POST/DELETE /api/categories` | 카테고리 CRUD |

---

### 4.3 Reviews (`/reviews`)

```
┌─────────────────────────────────────────────────────────────────────────┐
│  리뷰 분석                                                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─ 필터 ──────────────────────────────────────────────────────────────┐ │
│  │ 상품 선택: [□ 비타민C] [☑ 프로바이오틱스] [☑ 콜라겐] [□ ...]        │ │
│  │ 기간: [7일 ▼]  감정: [전체 ▼]  카테고리: [전체 ▼]                   │ │
│  └──────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌─ 통계 카드 ─────────────────────────────────────────────────────────┐ │
│  │ 선택 상품: 2개  |  총 리뷰: 390개  |  평균 평점: 4.3  |  긍정률: 76% │ │
│  └──────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  [트렌드] [비교] [키워드] [리뷰]                              [AI 분석]  │
│  ━━━━━━━━                                                               │
│                                                                          │
│  ┌─ 트렌드 탭 ─────────────────────────────────────────────────────────┐ │
│  │                         일별 리뷰 추이                               │ │
│  │     ●───●                                                           │ │
│  │    /     \      ●───●                                               │ │
│  │   /       \    /     \                                              │ │
│  │  ●         ●──●       ●───●                                         │ │
│  │  12/18  19  20  21  22  23  24                                      │ │
│  │                                                                      │ │
│  │  ━━ 프로바이오틱스   ━━ 콜라겐                                        │ │
│  └──────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌─ 키워드 탭 ─────────────────────────────────────────────────────────┐ │
│  │  ┌─ 긍정 키워드 ─────┐  ┌─ 부정 키워드 ─────┐                        │ │
│  │  │                  │  │                  │                        │ │
│  │  │   효과좋아요      │  │    배송지연       │                        │ │
│  │  │  먹기편해요 빠른배송│  │   포장불량 가격   │                        │ │
│  │  │    재구매의사     │  │                  │                        │ │
│  │  │                  │  │                  │                        │ │
│  │  └──────────────────┘  └──────────────────┘                        │ │
│  └──────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

**탭별 기능:**

| 탭 | 시각화 | 데이터 |
|-----|-------|-------|
| 트렌드 | Line Chart | 일별 리뷰 수 |
| 비교 | Bar Chart | 상품별 리뷰 수, 평균 평점 |
| 키워드 | Word Cloud | 감정별 키워드 빈도 |
| 리뷰 | Data Table | 원본 리뷰 목록 |

**AI 분석 버튼:**
- 미분석 리뷰 자동 태깅
- 인사이트 생성 (overview, pros, cons, actions, risks)

---

### 4.4 Categories (`/categories`)

```
┌─────────────────────────────────────────────────────────────────────────┐
│  카테고리 분석                                                           │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  카테고리 선택: [☑ 전체 선택]                                            │
│  [☑ 건강식품] [☑ 뷰티] [□ 식품] [□ 생활용품]                             │
│                                                                          │
│  ┌─ 통계 ───────────────────────────────────────────────────────────────┐│
│  │ 선택: 2개  |  상품: 8개  |  리뷰: 1,234개  |  평균: 4.1  |  긍정: 72% ││
│  └───────────────────────────────────────────────────────────────────────┘│
│                                                                          │
│  [트렌드] [리뷰] [평점] [감정]                                [AI 분석]   │
│  ━━━━━━━━                                                               │
│                                                                          │
│  ┌─ 감정 탭 ───────────────────────────────────────────────────────────┐ │
│  │                                                                      │ │
│  │  건강식품  ████████████████░░░░  80% 긍정 / 15% 부정 / 5% 중립       │ │
│  │  뷰티     ██████████████░░░░░░  70% 긍정 / 20% 부정 / 10% 중립      │ │
│  │                                                                      │ │
│  └──────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 5. API 명세

### 5.1 엔드포인트 요약

| Method | Endpoint | 설명 | Rate Limit |
|--------|----------|------|------------|
| **인증** ||||
| POST | `/api/auth/login` | 로그인 | - |
| GET | `/api/auth/check` | 인증 확인 | - |
| **카테고리** ||||
| GET | `/api/categories` | 목록 조회 | - |
| POST | `/api/categories` | 생성 | - |
| DELETE | `/api/categories?id=` | 삭제 | - |
| **상품** ||||
| GET | `/api/items` | 목록 조회 | - |
| POST | `/api/items` | 생성 | - |
| GET | `/api/items/{id}` | 단건 조회 | - |
| PUT | `/api/items/{id}` | 수정 | - |
| DELETE | `/api/items/{id}` | 삭제 | - |
| POST | `/api/items/extract` | 메타데이터 추출 | - |
| POST | `/api/items/{id}/crawl` | 리뷰 크롤링 | 10/min |
| **리뷰** ||||
| GET | `/api/reviews` | 목록 조회 | - |
| POST | `/api/reviews` | 통계 조회 | - |
| **분석** ||||
| POST | `/api/analyze` | AI 분석 실행 | 60/min |
| GET | `/api/analyze` | 분석 결과 조회 | - |

### 5.2 주요 API 상세

#### POST `/api/analyze`

```typescript
// Request
{
  itemIds: string[]
  type: "tag" | "insights" | "keywords"
  dateRange?: "7d" | "1m" | "3m" | "6m" | "1y"
}

// Response (type: "tag")
{
  analyzed: number
  results: Array<{
    reviewId: string
    sentiment: "positive" | "negative" | "neutral"
    keywords: string[]
  }>
}

// Response (type: "insights")
{
  overview: string
  pros: string[]
  cons: string[]
  actions: Array<{
    title: string
    detail: string
    owner_hint: string
    priority: "P0" | "P1" | "P2"
  }>
  risks: string[]
  evidence: Array<{
    reviewId: string
    why_relevant: string
  }>
}

// Response (type: "keywords")
{
  positive: Array<{ word: string, count: number }>
  negative: Array<{ word: string, count: number }>
}
```

---

## 6. 에러 처리

### 6.1 에러 코드

| 코드 | 상황 | 처리 |
|------|------|------|
| 400 | 잘못된 요청 | 사용자 입력 검증 |
| 401 | 인증 실패 | 로그인 페이지 리다이렉트 |
| 404 | 리소스 없음 | 404 페이지 또는 알림 |
| 500 | 서버 에러 | 에러 로깅 + 기본 응답 |
| 502 | 외부 API 실패 | 재시도 또는 캐시 사용 |
| 504 | 타임아웃 | 기본값 반환 |

### 6.2 Timeout 설정

```typescript
const TIMEOUTS = {
  DEFAULT_API: 30_000,      // 30초 (일반 API)
  CRAWLER_API: 120_000,     // 2분 (크롤링)
  OPENAI_API: 60_000,       // 1분 (AI 분석)
}
```

---

## 7. 성능 최적화

### 7.1 캐싱 전략

| 캐시 대상 | TTL | 키 패턴 |
|-----------|-----|---------|
| 크롤링 결과 | 30분 | `crawl:{itemId}` |
| 메타데이터 | 1시간 | `metadata:{url}` |
| 분석 결과 | 10분 | `analysis:{itemId}` |

### 7.2 Rate Limiting

| 대상 | 제한 | 윈도우 |
|------|------|--------|
| OpenAI API | 60 요청 | 1분 |
| Crawler API | 10 요청 | 1분 |

### 7.3 배치 처리

```typescript
// 리뷰 태깅: 5개씩 병렬 처리
const BATCH_SIZE = 5
for (let i = 0; i < reviews.length; i += BATCH_SIZE) {
  const batch = reviews.slice(i, i + BATCH_SIZE)
  await Promise.all(batch.map(tagReview))
}
```

---

## 8. 보안 고려사항

### 8.1 환경변수

```bash
# 공개 가능 (NEXT_PUBLIC_)
NEXT_PUBLIC_SUPABASE_URL=...

# 서버 전용 (절대 노출 금지)
SUPABASE_SERVICE_ROLE_KEY=...
OPENAI_API_KEY=...
AWS_ACCESS_KEY_ID=...
AWS_SECRET_ACCESS_KEY=...
```

### 8.2 인증

- 현재: 간단한 쿠키 기반 세션 (`admin/admin`)
- 향후: Supabase Auth 또는 NextAuth.js 도입 권장

### 8.3 입력 검증

```typescript
// URL 검증
const platform = detectPlatform(url)
if (!platform) {
  return Response.json({ error: "Unsupported platform" }, { status: 400 })
}

// ID 검증
if (!itemId || typeof itemId !== "string") {
  return Response.json({ error: "Invalid item ID" }, { status: 400 })
}
```

---

## 9. 확장 로드맵

### Phase 1: 현재 (MVP)
- ✅ 네이버 스마트스토어/브랜드스토어 크롤링
- ✅ GPT 기반 감정 분석
- ✅ 기본 대시보드 및 시각화

### Phase 2: 확장
- ⬜ 추가 플랫폼 (쿠팡, 11번가, G마켓)
- ⬜ 정기 크롤링 스케줄러
- ⬜ 이메일/슬랙 알림
- ⬜ 사용자 인증 시스템

### Phase 3: 고도화
- ⬜ 커스텀 키워드 사전
- ⬜ 경쟁사 비교 분석
- ⬜ 리뷰 이상 탐지
- ⬜ 다국어 지원

---

## 10. 용어집

| 용어 | 설명 |
|------|------|
| **CV (Consumer Voice)** | 소비자 의견/리뷰 |
| **Sentiment** | 감정 분석 결과 (긍정/부정/중립) |
| **Aspect** | 리뷰에서 언급된 측면 (배송, 품질 등) |
| **Crawling** | 웹사이트에서 데이터 수집 |
| **Tagging** | AI가 리뷰에 감정/키워드 태그 부여 |
| **Insights** | AI가 생성한 분석 요약 및 액션 아이템 |

---

## 부록: 파일 구조

```
📁 프로젝트 루트
├── 📁 app/                    # Next.js App Router
│   ├── 📁 api/                # API Routes
│   │   ├── 📁 auth/           # 인증 API
│   │   ├── 📁 categories/     # 카테고리 CRUD
│   │   ├── 📁 items/          # 상품 CRUD + 크롤링
│   │   ├── 📁 reviews/        # 리뷰 조회
│   │   └── 📁 analyze/        # AI 분석
│   ├── 📁 dashboard/          # 대시보드 페이지
│   ├── 📁 items/              # 상품 관리 페이지
│   ├── 📁 reviews/            # 리뷰 분석 페이지
│   ├── 📁 categories/         # 카테고리 페이지
│   └── 📁 login/              # 로그인 페이지
├── 📁 lib/                    # 핵심 라이브러리
│   ├── 📄 api.ts              # 프론트엔드 API 클라이언트
│   ├── 📄 supabase.ts         # Supabase 클라이언트
│   ├── 📄 local-db.ts         # 로컬 JSON DB
│   ├── 📁 services/
│   │   └── 📄 openai.ts       # OpenAI 서비스
│   └── 📁 utils/
│       ├── 📄 cache.ts        # 인메모리 캐시
│       └── 📄 rate-limiter.ts # Rate Limiter
├── 📁 components/             # UI 컴포넌트
├── 📁 types/                  # TypeScript 타입
└── 📁 .data/                  # 로컬 DB 저장소
    └── 📄 db.json
```
